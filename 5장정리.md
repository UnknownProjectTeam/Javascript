# 5. 실행 컨텍스트와 클로저

## 5.1 실행 컨텍스트 개념

- 실행 가능한 자바스크립트 코드 블록이 실행되는 환경

- 현재 실행되는 컨텍스트에서 이 컨텍스트와 관련 없는 실행 코드가 실행되면, 새로운 컨텍스트가 생성되어 스택에 들어가고 제어권이 그 컨텍스트로 이동한다.

```javascript
console.log(“This is global context”);

function ExContext1() {
    console.log(“This is ExContext1”);
}

function ExContext2() {
    ExContext1();
    console.log(“This is ExContext2”);
}

ExContext2();

//출력 결과
//This is global context
//This is ExContext1
//This is ExContext2
```



## 5.2 실행 컨텍스트 생성 과정

### 5.2.1 활성 객체 생성

- 실행 컨텍스트 생성 시, 자바스크립트 엔진에서 실행에 필요한 여러 정보를 담을 객체

### 5.2.2 arguments 객체 생성

- 활성 객체는 arguments 프로퍼티로 arguments 객체(4.4.1 arguments 객체 참고)를 참조

### 5.2.3 스코프 정보 생성

- 실행 컨텍스트의 유효 범위
- 실행 컨텍스트 안에서 연결 리스트와 유사한 형식으로 만들어짐
- 실행 컨텍스트에서 특정 변수에 접근해야 할 경우 활용
- 리스트를 스코프 체인이라 하고, 스코프 체인에서 찾지 못한 변수는 에러 검출

### 5.2.4 변수 생성

- 실행 컨텍스트의 내부에서 사용되는 지역 변수의 생성
- ECMAScript에서는 생성되는 변수를 저장하는 변수 객체를 언급하는데, 활성 객체가 변수 객체로 사용됨
- 변수 객체 안에서 호출된 함수 인자는 각각의 프로퍼티가 만들어지고 값이 할당됨
- 변수나 내부 함수를 메모리에 생성만 하고 초기화 하지 않은 상태

### 5.2.5 this 바인딩

- this 키워드 사용 값 할당
- 참조 객체가 없을 경우 전역 객체를 참조

### 5.2.6 코드 실행

- 실행 컨텍스트가 생성되고 변수 객체가 만들어진 후 코드에 있는 여러 가지 표현식 실행이 이루어지고 이 때, 변수의 초기화 및 연산, 또 다른 함수의 실행 등이 이루어짐
- 전역 객체의 경우 일반적인 실행 컨텍스트와 다르게 arguments객체가 없으며, 전역 객체 하나만을 포함하는 스코프 체인이 있음

## 5.3 스코프 체인

- 스코프 = 유효 범위, C 코드의 경우 {, }로 묶여 있는 범위
- 자바스크립트는 오직 함수만이 유효 범위의 한 단위이고 이 유효 범위를 나타내는 스코프가 [[scope]]프로퍼티로 각 함수 객체 내에서 연결 리스트 형식으로 관리되는데, 이를 스코프 체인이라고 함

### 5.3.1 전역 실행 컨텍스트의 스코프 체인
- 자바스크립트 코드 실행하면, 전역 실행 컨텍스트가 생성되고, 변수 객체가 만들어짐
- 전역 실행 컨텍스트는 참조할 상위 컨텍스트가 없음

### 5.3.2 함수를 호출한 경우 생성되는 실행 컨텍스트의 스코프 체인
- 각 함수 객체는 [[scope]] 프로퍼티로 현재 컨텍스트의 스코프 체인을 참조
- 한 함수가 실행되면 새로운 실행 컨텍스트가 만들어지는데, 이 새로운 실행 컨텍스트는 현재 실행되는 함수 객체의 [[scope]] 프로퍼티를 복사하고, 새롭게 생성된 변수 객체를 해당 체인의 제일 앞에 추가하는 방법으로 자신이 사용할 스코프 체인을 만듬
- 스코프 체인 = 현재 실행 컨텍스트의 변수 객체 + 상위 컨텍스트의 스코프 체인


## 5.4 클로저

### 5.4.1 클로저의 개념

- 이미 생명주기가 끝난 외부 함수의 변수를 참조하는 함수

### 5.4.2 클로저의 활용

#### 5.4.2.1 특정 함수에 사용자가 정의한 객체의 메서드 연결하기

#### 5.4.2.2 함수의 캡슐화

#### 5.4.2.3 setTimeout()에 지정되는 함수의 사용자 정의


### 5.4.3 클로저를 활용할 때 주의사항

#### 5.4.3.1 클로저의 프로퍼티 값이 쓰기 가능하므로 그 값이 여러번 호출로 항상 변할 수 있음에 유의해야 한다.

#### 5.4.3.2 하나의 클로저가 여러 함수 스코프 체인에 들어가 있는 경우도 있다

#### 5.4.3.3 루프 안에서 클로저를 활용할 때는 주의하자
